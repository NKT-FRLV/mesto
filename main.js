(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};t.d({},{Tp:()=>S,J3:()=>v});var e=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:{authorization:"d48aadef-370a-44fe-8d23-f216f65bbe9f","Content-Type":"application/json"}};return e&&(n.body=JSON.stringify(e)),fetch("".concat("https://nomoreparties.co/v1/wff-cohort-13","/").concat(t),n).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status," ").concat(t.statusText))})).catch((function(t){console.log(t),alert("Произошла ошибка: ".concat(t))}))},n=function(t){return e("cards/likes/".concat(t._id),"PUT")},r=function(t){return e("cards/likes/".concat(t._id),"DELETE")};function o(t,e,n,r){var o=S.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__image"),u=o.querySelector(".card__title"),a=o.querySelector(".card__likes-counter"),i=o.querySelector(".card__delete-button"),l=o.querySelector(".card__like-button"),s=t.likes.some((function(t){return t._id===v}));return c.src=t.link,c.alt=t.name,u.textContent=t.name,t.likes.length>0&&(a.style.display="block",a.textContent=t.likes.length),s&&l.classList.toggle("card__like-button_is-active"),i.addEventListener("click",(function(){e(o,t)})),t.owner._id!==v&&function(t,e,n,r){e.removeEventListener("click",(function(){t(n,r)})),e.remove()}(e,i,o,t),l.addEventListener("click",(function(){n(l,a,t)})),c.addEventListener("click",(function(){r(c)})),o}var c=function(t,n){(function(t){return e("cards/".concat(t._id),"DELETE")})(n).then((function(e){console.log(e.message),t.remove()})).catch((function(t){return console.error("Ошибка при удалении карточки:",t)}))},u=function(t,e,o){(o.likes.some((function(t){return t._id===v}))?r:n)(o).then((function(n){return t.classList.toggle("card__like-button_is-active"),o.likes=n.likes,e.textContent=n.likes.length,e.style.display="block",0===n.likes.length&&(e.style.display="none"),n})).catch((function(t){return console.error("Ошибка при добавлении лайка:",t)}))};function a(t){t.classList.add("popup_is-animated"),setTimeout((function(){t.classList.add("popup_is-opened")}),11),document.addEventListener("click",s),document.addEventListener("keydown",i)}function i(t){"Escape"===t.key&&l(document.querySelector(".popup_is-opened"))}function l(t){document.removeEventListener("click",s),document.removeEventListener("keydown",i),t.classList.remove("popup_is-opened"),setTimeout((function(){t.classList.remove("popup_is-animated")}),600);var e=t.querySelector("form");null!==e&&e.reset()}function s(t){t.target.classList.contains("popup_is-opened")&&l(t.target)}var p=function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},d=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function f(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function _(t,e){Array.from(t.querySelectorAll(".".concat(e.inputErrorClass))).forEach((function(n){d(t,n,e)}));var n=t.querySelector(e.submitButtonSelector);f(Array.from(t.querySelectorAll(e.inputSelector)),n,e)}function y(t,e,n,r){var o="https://corsproxy.io/?".concat(encodeURIComponent(t));return fetch(o,{method:"HEAD"}).then((function(t){if(!t.ok)return p(e,n,"URL недоступен или не существует",r),!1;var o=t.headers.get("content-type");return!(!o||!o.startsWith("image/"))||(p(e,n,"Ссылка не ведет к изображению",r),!1)}))}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var v,S=document.querySelector("#card-template").content,h=document.querySelector(".places__list"),b=document.querySelector(".profile__title"),g=document.querySelector(".profile__description"),q=document.querySelector(".content"),C=q.querySelector(".profile__edit-button"),k=q.querySelector(".profile__add-button"),L=q.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_change-avatar"),A=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_image"),j=E.querySelector(".popup__form"),w=A.querySelector(".popup__form"),D=x.querySelector(".popup__form"),O=j.querySelector(".popup__input_type_name"),P=j.querySelector(".popup__input_type_description"),B=w.querySelector(".popup__input_type_card-name"),I=w.querySelector(".popup__input_type_url"),U=x.querySelector(".popup__input_type_url"),M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},R=E.querySelector(M.formSelector),H=A.querySelector(M.formSelector),J=[e("users/me"),e("/cards")],N=function(){return Promise.all(J).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{userData:r[0],cardsData:r[1]}}))};function V(t){var e=T.querySelector(".popup__image"),n=T.querySelector(".popup__caption");e.src=t.src,e.alt=t.alt,n.textContent=t.alt,a(T)}N().then((function(t){var e=t.userData;return v=e._id,b.textContent=e.name,g.textContent=e.about,L.style.backgroundImage="url('".concat(e.avatar,"')"),e})),N().then((function(t){t.cardsData.forEach((function(t){var e=o(t,c,u,V);h.append(e)}))})),q.addEventListener("click",(function(t){t.target===C?(a(E),O.value=b.textContent,P.value=g.textContent,_(R,M)):t.target===k?(a(A),_(H,M)):t.target===L&&(a(x),_(D,M))})),j.addEventListener("submit",(function(t){t.preventDefault();var n,r,o=this.querySelector(".popup__button");o.textContent="Сохранение...",(n=O.value,r=P.value,e("/users/me","PATCH",{name:n,about:r})).then((function(t){b.textContent=t.name,g.textContent=t.about,l(E)})).catch((function(t){console.error(t)})).finally((function(){o.textContent="Сохранить"}))})),w.addEventListener("submit",(function(t){t.preventDefault();var n=B.value,r=I.value,a=this.querySelector(".popup__button");a.textContent="Сохранение...",y(r,w,I,M).then((function(t){var i,s;t?(i=n,s=r,e("/cards","POST",{name:i,link:s})).then((function(t){var e=o(t,c,u,V);h.prepend(e),w.reset(),a.textContent="Сохранить",l(A)})):(console.log("URL недоступен или не существует"),a.textContent="Сохранить")}))})),D.addEventListener("submit",(function(t){t.preventDefault();var n=U.value,r=this.querySelector(".popup__button");y(n,D,U,M).then((function(t){var o;t?(r.textContent="Сохранение...",(o=n,e("/users/me/avatar","PATCH",{avatar:o})).then((function(t){L.style.backgroundImage="url('".concat(t.avatar,"')"),U.value="",r.textContent="Сохранить",l(x)})).catch((function(t){console.error(t)}))):(console.log("URL недоступен или не существует"),r.textContent="Сохранить")}))})),document.addEventListener("click",(function(t){t.target.classList.contains("popup__close")&&l(t.target.closest(".popup"))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);f(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(t,e,n):p(t,e,e.validationMessage,n)}(t,o,e),f(n,r,e)}))}))}(e,t)}))}(M)})();