(()=>{"use strict";var t=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",headers:{authorization:"d48aadef-370a-44fe-8d23-f216f65bbe9f","Content-Type":"application/json"}};return e&&(n.body=JSON.stringify(e)),fetch("".concat("https://nomoreparties.co/v1/wff-cohort-13","/").concat(t),n).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status," ").concat(t.statusText))}))},e=function(e){return t("cards/likes/".concat(e._id),"PUT")},n=function(e){return t("cards/likes/".concat(e._id),"DELETE")};function r(t,e,n,r,o,c){var u=n.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__image"),i=u.querySelector(".card__title"),l=u.querySelector(".card__likes-counter"),s=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like-button"),d=e.likes.some((function(e){return e._id===t}));return a.src=e.link,a.alt=e.name,i.textContent=e.name,e.likes.length>0&&(l.textContent=e.likes.length),d&&p.classList.toggle("card__like-button_is-active"),e.owner._id===t?s.addEventListener("click",(function(){r(u,e)})):s.remove(),p.addEventListener("click",(function(){o(p,l,e,t)})),a.addEventListener("click",(function(){c(a)})),u}var o=function(e,n){(function(e){return t("cards/".concat(e._id),"DELETE")})(n).then((function(t){console.log(t.message),e.remove()})).catch((function(t){return console.error("Ошибка при удалении карточки:",t)}))},c=function(t,r,o,c){(o.likes.some((function(t){return t._id===c}))?n:e)(o).then((function(e){return t.classList.toggle("card__like-button_is-active"),o.likes=e.likes,r.textContent=e.likes.length,0===e.likes.length&&(r.textContent=""),e})).catch((function(t){return console.error("Ошибка при добавлении лайка:",t)}))};function u(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",a)}function a(t){"Escape"===t.key&&i(document.querySelector(".popup_is-opened"))}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function l(t){t.target.classList.contains("popup_is-opened")&&i(t.target)}var s=function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)},p=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""};function d(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))}function f(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(n){p(t,n,e)})),d(n,t.querySelector(e.submitButtonSelector),e)}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var y,m=document.querySelector("#card-template").content,v=document.querySelector(".places__list"),S=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),q=document.querySelector(".content"),b=q.querySelector(".profile__edit-button"),g=q.querySelector(".profile__add-button"),C=q.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit"),k=document.querySelector(".popup_change-avatar"),L=document.querySelector(".popup_type_new-card"),x=document.querySelector(".popup_type_image"),A=Array.from(document.querySelectorAll(".popup")),w=E.querySelector(".popup__form"),T=L.querySelector(".popup__form"),j=k.querySelector(".popup__form"),D=w.querySelector(".popup__input_type_name"),P=w.querySelector(".popup__input_type_description"),B=T.querySelector(".popup__input_type_card-name"),I=T.querySelector(".popup__input_type_url"),O=k.querySelector(".popup__input_type_url"),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},M=E.querySelector(U.formSelector),R=L.querySelector(U.formSelector);function H(t,e,n,r,o,c){t.preventDefault();var u=t.submitter;u.textContent="Сохранение...",function(t,e,n,r){return new Promise((function(o,c){var u=new Image;u.onload=function(){o(!0)},u.onerror=function(){s(e,n,"URL недоступен или не существует",r),c("URL недоступен или не существует, пожалуйста, проверьте URL")},u.src=t}))}(e,n,r,o).then((function(t){t&&c(e).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){u.textContent="Сохранить"}))})).catch((function(t){console.log("Ошибка: ".concat(t)),u.textContent="Сохранить"}))}function N(t){var e=x.querySelector(".popup__image"),n=x.querySelector(".popup__caption");e.src=t.src,e.alt=t.alt,n.textContent=t.alt,u(x)}Promise.all([t("users/me"),t("/cards")]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==e);i=!0);}catch(t){l=!0,o=t}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{userData:r[0],cardsData:r[1]}})).then((function(t){var e=t.userData,n=t.cardsData;y=e._id,S.textContent=e.name,h.textContent=e.about,C.style.backgroundImage="url('".concat(e.avatar,"')"),n.forEach((function(t){var e=r(y,t,m,o,c,N);v.append(e)})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);d(n,r,e),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?p(t,e,n):s(t,e,e.validationMessage,n)}(t,o,e),d(n,r,e)}))}))}(e,t)}))}(U)})).catch((function(t){console.log("Произошла ошибка при получении данных с сервера:",t),console.error(t)})),b.addEventListener("click",(function(){u(E),D.value=S.textContent,P.value=h.textContent,f(M,U)})),g.addEventListener("click",(function(){u(L),T.reset(),f(R,U)})),C.addEventListener("click",(function(){u(k),j.reset(),f(j,U)})),A.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){i(t)})),t.addEventListener("click",l)})),w.addEventListener("submit",(function(e){e.preventDefault();var n,r,o=this.querySelector(".popup__button");o.textContent="Сохранение...",(n=D.value,r=P.value,t("/users/me","PATCH",{name:n,about:r})).then((function(t){S.textContent=t.name,h.textContent=t.about,i(E)})).catch((function(t){console.log("Ошибка: ".concat(t))})).finally((function(){o.textContent="Сохранить"}))})),T.addEventListener("submit",(function(e){var n=B.value;H(e,I.value,T,I,U,(function(e){return(u=n,a=e,t("/cards","POST",{name:u,link:a})).then((function(t){var e=r(y,t,m,o,c,N);v.prepend(e),i(L)}));var u,a}))})),j.addEventListener("submit",(function(e){var n=O.value;console.log(e.submitter),H(e,n,j,O,U,(function(e){return(n=e,t("/users/me/avatar","PATCH",{avatar:n})).then((function(t){C.style.backgroundImage="url('".concat(t.avatar,"')"),i(k)}));var n}))}))})();